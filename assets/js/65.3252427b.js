(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{529:function(_,e,v){"use strict";v.r(e);var t=v(9),s=Object(t.a)({},(function(){var _=this,e=_._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[e("h1",{attrs:{id:"centos7调整磁盘分区"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#centos7调整磁盘分区"}},[_._v("#")]),_._v(" CentOS7调整磁盘分区")]),_._v(" "),e("h2",{attrs:{id:"对磁盘进行扩容"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#对磁盘进行扩容"}},[_._v("#")]),_._v(" 对磁盘进行扩容")]),_._v(" "),e("p",[_._v("当磁盘空间不足时，需要对磁盘进行扩容。可以在虚拟机选项中直接增加磁盘大小，比如增加100G到300G。")]),_._v(" "),e("p",[e("img",{attrs:{src:"/img/linux/resize,m_fixed,w_750.webp",alt:"CentOS7调整磁盘分区_运维_13"}})]),_._v(" "),e("p",[_._v("使用"),e("code",[_._v("fdisk /dev/sda")]),_._v("命令对新加磁盘空间进行分区，先输入"),e("code",[_._v("m")]),_._v("查看帮助。")]),_._v(" "),e("p",[e("img",{attrs:{src:"/img/linux/resize,m_fixed,w_750-16654524595953.webp",alt:"CentOS7调整磁盘分区_运维_14"}})]),_._v(" "),e("p",[_._v("输入"),e("code",[_._v("n")]),_._v("选择增加新分区，输入"),e("code",[_._v("p")]),_._v("选择分区格式为主分区。然后直接按两次回车使用默认的起始扇区和结束扇区，这样能充分利用全部扇区。操作后提示100G分区已添加。输入"),e("code",[_._v("w")]),_._v("进行提交操作")]),_._v(" "),e("p",[e("img",{attrs:{src:"/img/linux/resize,m_fixed,w_750-16654525261266.webp",alt:"CentOS7调整磁盘分区_linux_15"}})]),_._v(" "),e("p",[_._v("使用"),e("code",[_._v("fdisk -l")]),_._v("查看多出来一个"),e("code",[_._v("/dev/sda3")]),_._v("的磁盘。")]),_._v(" "),e("p",[e("img",{attrs:{src:"/img/linux/resize,m_fixed,w_750-16654527275139.webp",alt:"CentOS7调整磁盘分区_运维_16"}})]),_._v(" "),e("p",[_._v("使用"),e("code",[_._v("partprobe")]),_._v("命令用于重读分区表,将磁盘分区表变化信息通知内核,请求操作系统重新加载分区表")]),_._v(" "),e("p",[_._v("使用命令"),e("code",[_._v("pvcreate /dev/sda3")]),_._v("创建物理卷")]),_._v(" "),e("p",[e("img",{attrs:{src:"/img/linux/resize,m_fixed,w_750-166545279419312.webp",alt:"CentOS7调整磁盘分区_操作系统_17"}})]),_._v(" "),e("p",[_._v("使用"),e("code",[_._v("vgscan")]),_._v("查询物理卷，可以查到本机物理卷名称为"),e("code",[_._v("cl")]),_._v("，然后使用"),e("code",[_._v("vgextend")]),_._v("扩展物理卷cl，键入命令"),e("code",[_._v("vgextend cl /dev/sda3")]),_._v("。")]),_._v(" "),e("p",[e("img",{attrs:{src:"/img/linux/resize,m_fixed,w_750-166545291866115.webp",alt:"CentOS7调整磁盘分区_linux_18"}})]),_._v(" "),e("p",[_._v("再使用"),e("code",[_._v("lvextend")]),_._v("扩展逻辑卷，命令："),e("code",[_._v("lvextend -L +100G /dev/mapper/cl-root")]),_._v("。")]),_._v(" "),e("p",[_._v("接着用"),e("code",[_._v("df -h")]),_._v("查看，发现实际容量并没有变化，因为系统还不认识刚添加进来的磁盘文件系统，所以还需要使用"),e("code",[_._v("xfs_growfs")]),_._v("对文件系统进行扩容。命令：")]),_._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[_._v("xfs_growfs /dev/mapper/cl-root\n")])])]),e("p",[_._v("或者使用"),e("code",[_._v("resize2fs –f")]),_._v("加上要扩展的分区名。")]),_._v(" "),e("p",[e("img",{attrs:{src:"/img/linux/resize,m_fixed,w_750-166545306686818.webp",alt:"CentOS7调整磁盘分区_运维_19"}})]),_._v(" "),e("p",[_._v("再使用"),e("code",[_._v("df -h")]),_._v("查看，分区扩展成功。")]),_._v(" "),e("p",[e("img",{attrs:{src:"/img/linux/resize,m_fixed,w_750-166545308805821.webp",alt:"CentOS7调整磁盘分区_centos_20"}})]),_._v(" "),e("h2",{attrs:{id:"磁盘分区错误"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#磁盘分区错误"}},[_._v("#")]),_._v(" 磁盘分区错误")]),_._v(" "),e("p",[_._v("新建虚拟机时，给虚拟机本身分配有200G磁盘空间。")]),_._v(" "),e("p",[e("img",{attrs:{src:"/img/linux/resize,m_fixed,w_750-166546531824924.webp",alt:"CentOS7调整磁盘分区_运维"}})]),_._v(" "),e("p",[_._v("在分区时，模拟错误分区，对系统的默认分区不作调整。此时/目录只有50G，而/home分区有141GB。")]),_._v(" "),e("p",[e("img",{attrs:{src:"/img/linux/resize,m_fixed,w_750-166546533247827.webp",alt:"CentOS7调整磁盘分区_linux_02"}})]),_._v(" "),e("p",[_._v("进入系统后，使用"),e("code",[_._v("df -h")]),_._v("命令查看分区和磁盘使用情况。此时"),e("code",[_._v("/home")]),_._v("目录的磁盘空间需要移除，全部分给"),e("code",[_._v("/root")]),_._v("目录（也就是cl-root）。")]),_._v(" "),e("p",[e("img",{attrs:{src:"/img/linux/resize,m_fixed,w_750-166546535334130.webp",alt:"CentOS7调整磁盘分区_lvm_03"}})]),_._v(" "),e("p",[_._v("使用"),e("code",[_._v("fdisk -l")]),_._v("查看物理磁盘挂载情况。")]),_._v(" "),e("p",[e("img",{attrs:{src:"/img/linux/resize,m_fixed,w_750-166546550724133.webp",alt:"CentOS7调整磁盘分区_centos_04"}})]),_._v(" "),e("p",[_._v("调整分区前正常是要备份数据的，可参考如下操作。但是新装系统没有什么数据的情况，可以不要数据，直接操作。")]),_._v(" "),e("p",[e("img",{attrs:{src:"/img/linux/resize,m_fixed,w_750-166546552816736.webp",alt:"CentOS7调整磁盘分区_运维_05"}})]),_._v(" "),e("p",[_._v("卸载/home。")]),_._v(" "),e("p",[_._v("如果"),e("code",[_._v("/home")]),_._v("存在进程，需要使用"),e("code",[_._v("fuser -m -v -I -k /home")]),_._v("终止"),e("code",[_._v("/home")]),_._v("下的进程，然后再使用"),e("code",[_._v("umount")]),_._v("卸载"),e("code",[_._v("/home")]),_._v("。")]),_._v(" "),e("p",[e("img",{attrs:{src:"/img/linux/resize,m_fixed,w_750-166546910532557.webp",alt:"CentOS7调整磁盘分区_linux_06"}})]),_._v(" "),e("p",[_._v("然后删除"),e("code",[_._v("/home")]),_._v("所在的lv。")]),_._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[_._v("lvremove /dev/mapper/cl-home\n")])])]),e("p",[_._v("使用"),e("code",[_._v("lvextend")]),_._v("扩展逻辑卷"),e("code",[_._v("/root")]),_._v("，增加141G（如果增加空间超过可用大小，会报错）。")]),_._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[_._v("lvextend "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[_._v("-L")]),_._v(" +141G /dev/mapper/cl-root\n")])])]),e("p",[e("img",{attrs:{src:"/img/linux/resize,m_fixed,w_750-166546556930439.webp",alt:"CentOS7调整磁盘分区_centos_07"}})]),_._v(" "),e("p",[_._v("使用"),e("code",[_._v("xfs_growfs")]),_._v("对文件系统"),e("code",[_._v("/root")]),_._v("进行扩容。")]),_._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[_._v("xfs_growfs /dev/mapper/cl-root\n")])])]),e("p",[e("img",{attrs:{src:"/img/linux/resize,m_fixed,w_750-166546559579442.webp",alt:"CentOS7调整磁盘分区_centos_08"}})]),_._v(" "),e("h2",{attrs:{id:"创建-home分区"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建-home分区"}},[_._v("#")]),_._v(" 创建/home分区")]),_._v(" "),e("p",[_._v("如果某些特定场景，需要使用"),e("code",[_._v("/home")]),_._v("分区，而开始没有划分，则可以参照下文进行添加。")]),_._v(" "),e("p",[_._v("使用"),e("code",[_._v("vgdisplay")]),_._v("命令查看剩余分区大小，然后创建一个逻辑卷“home”。")]),_._v(" "),e("p",[e("img",{attrs:{src:"/img/linux/resize,m_fixed,w_750-166546561362045.webp",alt:"CentOS7调整磁盘分区_lvm_09"}})]),_._v(" "),e("p",[_._v("此时使用"),e("code",[_._v("fdisk -l")]),_._v("已经可以看到新的分区。")]),_._v(" "),e("p",[e("img",{attrs:{src:"/img/linux/resize,m_fixed,w_750-166546563235348.webp",alt:"CentOS7调整磁盘分区_运维_10"}})]),_._v(" "),e("p",[_._v("然后使用"),e("code",[_._v("mkfs.xfs")]),_._v("命令格式化分区，分区类型为"),e("code",[_._v("xfs")]),_._v("。")]),_._v(" "),e("p",[e("img",{attrs:{src:"/img/linux/resize,m_fixed,w_750-166546564976951.webp",alt:"CentOS7调整磁盘分区_linux_11"}})]),_._v(" "),e("p",[_._v("最后使用"),e("code",[_._v("mount")]),_._v("进行挂载，挂载位置为"),e("code",[_._v("/home")]),_._v("。再使用"),e("code",[_._v("df -h")]),_._v("进行查看，挂载成功。")]),_._v(" "),e("p",[e("img",{attrs:{src:"/img/linux/resize,m_fixed,w_750-166546688910554.webp",alt:"CentOS7调整磁盘分区_centos_12"}})]),_._v(" "),e("h2",{attrs:{id:"新增磁盘挂载扩容"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#新增磁盘挂载扩容"}},[_._v("#")]),_._v(" 新增磁盘挂载扩容")]),_._v(" "),e("p",[_._v("实际使用中，也有可能当前存储用完了，需要新增其他分区，那么要使用添加硬盘，新增一块硬盘来处理。如下图，新增一块100G硬盘。")]),_._v(" "),e("p",[e("img",{attrs:{src:"/img/linux/resize,m_fixed,w_750-166546958990460.webp",alt:"CentOS7调整磁盘分区_lvm_21"}})]),_._v(" "),e("p",[_._v("系统中使用"),e("code",[_._v("fdisk -l")]),_._v("查看，多了一块100G的sdb。")]),_._v(" "),e("p",[e("img",{attrs:{src:"/img/linux/resize,m_fixed,w_750-166546960491863.webp",alt:"CentOS7调整磁盘分区_运维_22"}})]),_._v(" "),e("p",[_._v("此时并不能直接使用，要使用"),e("code",[_._v("fdisk")]),_._v("进行分区。和前面类似，使用"),e("code",[_._v("fdisk /dev/sdb")]),_._v("对新硬盘进行分区。键入"),e("code",[_._v("n")]),_._v("创建分区，选择"),e("code",[_._v("p")]),_._v("分区类型为主分区，两次回车，最后"),e("code",[_._v("w")]),_._v("写入分区。")]),_._v(" "),e("p",[e("img",{attrs:{src:"/img/linux/resize,m_fixed,w_750-166546961837066.webp",alt:"CentOS7调整磁盘分区_lvm_23"}})]),_._v(" "),e("p",[_._v("还是一样，使用"),e("code",[_._v("partprobe")]),_._v("通知系统分区表的变化，再使用"),e("code",[_._v("pvcreate")]),_._v("创建物理卷。使用"),e("code",[_._v("vgscan")]),_._v("查询物理卷，然后使用"),e("code",[_._v("vgextend")]),_._v("新增物理卷扩展"),e("code",[_._v("cl")]),_._v("。使用"),e("code",[_._v("lvextend")]),_._v("扩展逻辑卷，最后使用"),e("code",[_._v("xfs_growfs")]),_._v("对文件系统进行扩容。再使用"),e("code",[_._v("df -h")]),_._v("查看，分区扩展成功。")]),_._v(" "),e("p",[e("img",{attrs:{src:"/img/linux/resize,m_fixed,w_750-166546963552369.webp",alt:"CentOS7调整磁盘分区_linux_24"}})])])}),[],!1,null,null,null);e.default=s.exports}}]);